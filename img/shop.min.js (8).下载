(function(){var a={name:"localStorage",init:function(){if(!window.localStorage)return!1;this._storage=window.localStorage;return this},setStorage:function(a,b){this._storage.setItem(a,b);return!0},getStorage:function(a,b){var d=this._storage.getItem(a);b(d?d:null)},removeStorage:function(a){this._storage.removeItem(a);return!0},clearStorage:function(){if(this._storage.clear)this._storage.clear();else for(i in this._storage)this._storage[i].value&&this.remove(i);return!0}},c={name:"globalStorage",
init:function(){if(!Browser.firefox||!window.globalStorage)return!1;this._storage=globalStorage[location.hostname];return this},setStorage:function(a,b){this._storage.setItem(a,b);return!0},getStorage:function(a,b){var d=this._storage.getItem(a);b(d?d.value:null)},removeStorage:function(a){this._storage.removeItem(a);return!0},clearStorage:function(){if(this._storage.clear)this._storage.clear();else for(i in this._storage)this._storage[i].value&&this.remove(i);return!0}},b={name:"userdata",init:function(){this.Master=
"ie6+";if(!Browser.ie)return!1;this.file_name="ECStore_VS";if(!this._storage)try{var a=this._storage=document.createElement("input");a.type="hidden";a.addBehavior("#default#userData");document.body.appendChild(a);a.save(this.file_name)}catch(b){}return this},setStorage:function(a,b){this._storage.setAttribute(a,b);this._storage.save(this.file_name);return!0},getStorage:function(a,b){this._storage.load(this.file_name);b(this._storage.getAttribute(a))},removeStorage:function(a){this._storage.removeAttribute(a);
this._storage.save(this.file_name);return!0},clearStorage:function(){this._storage.load(this.file_name);var a=new Date;a.setMinutes(a.getMinutes()-1);this._storage.expires=a.toUTCString();this._storage.save(this.file_name);return!0}},d={name:"openDatabase",init:function(){if(!window.openDatabase)return!1;this._storage=window.openDatabase("viewState","1.0","ECStore ViewState Storage",2E4);this._createTable();return this},setStorage:function(a,b){this._storage.transaction(function(d){d.executeSql("SELECT v FROM SessionStorage WHERE k = ?",
[a],function(d,c){c.rows.length?d.executeSql("UPDATE SessionStorage SET v = ?  WHERE k = ?",[b,a]):d.executeSql("INSERT INTO SessionStorage (k, v) VALUES (?, ?)",[a,b])})});return!0},getStorage:function(a,b){this._storage.transaction(function(d){v=d.executeSql("SELECT v FROM SessionStorage WHERE k = ?",[a],function(a,d){if(d.rows.length)return b(d.rows.item(0).v);b(null)})})},removeStorage:function(a){this._storage.transaction(function(b){b.executeSql("DELETE FROM SessionStorage WHERE k = ?",[a])});
return!0},clearStorage:function(){this._storage.transaction(function(a){a.executeSql("DROP TABLE SessionStorage",[])});return!0},_createTable:function(){this._storage.transaction(function(a){a.executeSql("SELECT COUNT(*) FROM SessionStorage",[],function(){},function(a,b){a.executeSql("CREATE TABLE SessionStorage (k TEXT, v TEXT)",[],function(){})})})}},e={setStorage:function(){},getStorage:function(){},removeStorage:function(){},clearStorage:function(){}};BrowserStore=new Class({initialize:function(){this.storage=
d.init()||c.init()||a.init()||b.init()||e;return this},set:function(a,b){b&&"string"===typeOf(b)&&this.storage.setStorage(a,b);return this},get:function(a,b){this.storage.getStorage(a,b)},remove:function(a){if(!a||!this.storage)return!1;a&&this.storage.removeStorage(a);return this},clear:function(){if(!this.storage)return!1;this.storage.clearStorage();return this}})})();var Memory=(new Class({Implements:Cookie,options:{path:window.Shop?Shop.base_url.toLowerCase():"",domain:!1,duration:!1,secure:!1,document:document,encode:!0},initialize:function(a,c){a=a||"";0==a.indexOf("S[")&&(a=a.substr(1));var b=a.indexOf("[");this.key="S";-1<b?a.lastIndexOf("]")==a.length-1?this.key+=(b?"["+a.substr(0,b)+"]":"")+(b?a.substr(b):a):this.key+=a:this.key+="["+a.replace(".","][")+"]";this.key=this.key.toUpperCase();isNaN(c)||(c={duration:c});this.setOptions(c)},write:function(a){this.options.encode&&
(a=encodeURIComponent(a));this.options.domain&&(a+="; domain="+this.options.domain.toLowerCase());this.options.path&&(a+="; path="+this.options.path.toLowerCase());if(this.options.duration){var c=new Date;c.setTime(c.getTime()+864E5*this.options.duration);a+="; expires="+c.toGMTString()}this.options.secure&&(a+="; secure");this.options.document.cookie=this.key+"="+a;return this}})).extend({set:function(a,c,b){return(new Memory(a,b)).write(c)},get:function(a){return(new Memory(a)).read()},clean:function(a,
c){return(new Memory(a,c)).dispose()}}),Module=function(a,c,b){this.get=function(a){a=a.split(/[._]/);if(2>a.length)return null;var b=a[0];a=a[1];if(b=this[b])return b[a]};this.mod=function(a,b,c){this.set(a,b,c);var f=this[a];Object.each(f,function(a,b){f[b]=document.id(a.module)});return this};this.set=function(a,b,c){function f(a,b){a[b]=a[b]||{};return a[b]}var h=f(this,a);"object"==typeOf(b)?Object.each(b,function(a,b){f(h,b).module=a}):"array"==typeOf(b)?b.each(function(b){"object"==typeOf(b)?
Object.each(b,function(a,b){f(h,b).module=a}):"string"==typeOf(b)&&(c=a+"_"+b,f(h,b).module=c)}):"string"==typeOf(b)&&(c=c||a+"_"+b,f(h,b).module=c);return this};this.dom=function(a,b,c){var f=b+">"+c;if(this[f])return this[f];b=this.get(b);this[f]=b?b[a](c):null;return this[f]};this.element=function(a,b){return this.dom("getElement",a,b)};this.elements=function(a,b){return this.dom("getElements",a,b)};if(a)return this.mod(a,c,b)};
function setGridSize(a,c,b){b=b||0;var d=0,e=a.length;if(0!=e){for(;d<e;d++){var g=a[d],f=g.getPosition().y;if(0<d){var h=a[d-1];g.innerHTML.trim()||g.setStyle("height",h.getStyle("height"));0==b&&(g=h.getPosition().y,f>g&&(b=d))}}0==b&&(b=e);d=a[0].getParent();d=d.getSize().x-d.getPatch().x;a[b-1]&&(d+=parseInt(a[b-1].getStyle("margin-right")));d=parseInt(d/b);a.setStyle("width",d-a[0].getPatch().x);d=0;for(e=a.length/b;d<e;d++){var l=a.slice(d*b,b*(d+1));l.length&&(l[0].addClass("first"),l.getLast().addClass("last"),
c.each(function(a){setEqualHeight(l.invoke("getElement",a))}))}}}function autoGridLayout(a,c,b){a=$$(a);if(a.length){if(null===b||"undefined"===typeof b)b=!0;c=a[0].getParent(c);c=c.getSize().x-c.getPatch("padding","border").x;var d=parseInt(a[0].getStyle("width")),d=a[0].getSize().x||d+a[0].getPatch("padding","border").x,e=parseInt(c/d),g=parseInt((c-e*d)/(e-1));if(b){var f;a.each(function(a,b){f=0===(b+1)%e?0:g;a.setStyle("margin-right",f)})}else a.setStyle("margin-right",g)}}
function getRowsHeight(a){var c=0;a.each(function(a){a&&(a=a.getStyle("height").toInt(),a>c&&(c=a))});return c}function setEqualHeight(a,c){c||(c=getRowsHeight(a));a.each(function(a){a&&a.getStyle("height").toInt()<c&&a.setStyle("height",c)})}
var fixImageSize=function(a,c){(a||a.length)&&Array.from(a).each(function(a){"IMG"!==a.tagName&&(a=a.getElement("img"));a.src&&new Asset.image(a.src,{onload:function(){var d=a.getParent(c);if(!this||!this.get("width"))return d.adopt(a);"auto"==d.getComputedStyle("width")&&(d=d.getParent());var e=parseInt(a.getStyle("max-width"))||d.getSize().x-d.getPatch("border","padding").x,d=parseInt(a.getStyle("max-height"))||d.getSize().y-d.getPatch("border","padding").y;0>=e||0>=d||a.zoomImg(e,d)}})})};
window.addEvent("domready",function(a){fixImageSize($$("img[data-img-zoom]"))});function updateCartInfo(a){a=Memory.get("cart_number");var c=Memory.get("cart_count"),b=Memory.get("cart_total_price");try{(a||0===a)&&$$(".op-cart-number").set("text",a),(c||0===c)&&$$(".op-cart-count").set("text",c),(b||0===b)&&$$(".op-cart-total").set("text",b)}catch(d){}}
(function(){browserStore=null;withBrowserStore=function(a){if(browserStore)return a(browserStore);window.addEvent("domready",function(){(browserStore=new BrowserStore)?a(browserStore):window.addEvent("load",function(){a(browserStore=new BrowserStore)})})}})();var priceControl={spec:{decimals:2,dec_point:".",thousands_sep:"",fonttend_decimal_type:0,fonttend_decimal_remain:2,sign:"￥"},format:function(a,c){var b,d=this.spec.sign||"";if(!a&&0!==a||isNaN(+a))return a;a=parseFloat(a);this.spec.cur_rate&&(a*=this.spec.cur_rate);a=a.round(this.spec.decimals)+"";var e=a.indexOf(".");0>e?(e=a.length,b=""):b=a.substr(e+1);for(;b.length<this.spec.decimals;)b+="0";for(var g=[];0<e;)if(2<e)e-=3,g.unshift(a.substr(e,3));else{g.unshift(a.substr(0,e));break}b||(this.spec.dec_point=
"");c&&(d='<span class="price-currency">'+d+"</span>");return d+g.join(this.spec.thousands_sep)+this.spec.dec_point+b},number:function(a){if(!a)return null;isNaN(+a)&&("element"===typeOf(a)&&(a=a.get("INPUT"===a.tagName?"value":"text")),0==a.indexOf(this.spec.sign)&&(a=a.split(this.spec.sign)[1]));return+a},calc:function(a,c,b,d){if(!c&&0!==c)return null;if(b){a=a&&"add"!=a?-1:1;var e=1,g=1;"array"===typeOf(c)&&(e=c[1],c=c[0]);"array"===typeOf(b)&&(g=b[1],b=b[0]);var f=Math.pow(10,this.spec.decimals*
this.spec.decimals);c=Math.abs(e*f*this.number(c)+a*g*f*this.number(b))/f}else c=this.number(c);d||(c=this.format(c));return c},add:function(a,c,b){return this.calc("add",a,c,b)},diff:function(a,c,b){return this.calc("diff",a,c,b)}};
function bindDatepicker(a){a||(a="input.calendar");a=$$(a);var c=window.Shop?Shop.url.datepicker:"";if(a.length)try{$LAB.script(c+"/datepicker.js").wait(function(){a.each(function(a){var b;try{b=JSON.decode(a.get("data-calendar-options"))}catch(c){}new DatePickers(a,b)})})}catch(b){}}
window.addEvent("domready",function(){bindDatepicker();var a=window.Shop?Shop.url.fav_url:"",c=Memory.get("member"),c=new Memory("gfav."+c,365),b=function(b,c,d){function e(a){a.innerHTML='<span class="fav-on">已收藏</span> <i>|</i> <a href="javascript:void(0);" class="btn-delete">移除</a>'}if(c&&!b.hasClass("fav-on")){var k=b.getParent(".p-action");if(d)return e(k);b=b.get("_type")?b.get("_type"):"goods";(new Request({url:a,onRequest:function(){this.FAVHTML=k.innerHTML;k.innerHTML='<span class="fav-loading">收藏中...</span>'},
onSuccess:function(a){(a=JSON.decode(a))&&a.success?(k.innerHTML='<span class="fav-success"><q class="icon">&#x25;</q> 收藏成功</span>',e.delay(2E3,this,k)):k.innerHTML=this.FAVHTML}})).post({type:b,gid:c})}},d=function(b,c,d){function e(){b.getParent().getElement("[rev="+b.get("rel")+"]").setStyle("display","").replaces(b)}if(c){if(d)return e();d=b.get("data-type")?b.get("data-type"):"goods";(new Request({url:a,onRequest:function(){this.FAVHTML=b.innerHTML;b.innerHTML='<span class="fav-loading">收藏中...</span>'},
onSuccess:function(a){a=JSON.decode(a);a.success&&e()}})).post({type:d,gid:c})}},e=Array.from((c.read()||"").split(","));$$("a[rel=_addfav_]").each(function(a){var c=a.get("data-gid");e.contains(c)&&b(a,c,!0)});$$("[rel=_favbtn_]").each(function(a){var b=a.get("data-gid");e.contains(b)&&d(a,b,!0)});window.Event_Group&&Object.merge(Event_Group,{_addfav_:{fn:function(a){a=$(a.target)||$(a);b(a,a.get("data-gid"));return!1}},_favbtn_:{fn:function(a){a=$(a.target)||$(a);d(a,a.get("data-gid"));return!1}}})});
function starGrade(a,c,b){a=$(a);c=parseInt(c);a&&a.getElements(b||".scores-item").each(function(a){var b=a.getElement(".stars"),g=a.getElements("[class*=star-]"),f=a.getElement("input[type=hidden]"),h=a.getElement(".score");c||0===c?(b.className="stars stars-"+c,h.set("text",c),f.value=c):(b.addEvent("mouseleave",function(){var a=f.value;this.className="stars stars-"+a;h.set("text",a)}),g.each(function(a,b){a.addEvents({mouseenter:function(){this.getParent(".stars").className="stars stars-"+(b+1);
h.set("text",b+1)},click:function(){f.value=b+1}})}))})};